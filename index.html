<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Heads Up – Custom Deck</title>
  <meta name="description" content="Lightweight Heads Up-style game. Paste your own words, play on any phone." />
  <style>
    :root{
      --bg:#0f172a;         /* slate-900 */
      --panel:#111827cc;    /* gray-900/80 */
      --ink:#e5e7eb;        /* gray-200 */
      --muted:#9ca3af;      /* gray-400 */
      --accent:#22c55e;     /* green-500 */
      --accent-2:#3b82f6;   /* blue-500 */
      --warn:#f59e0b;       /* amber-500 */
      --danger:#ef4444;     /* red-500 */
    }
    html,body{height:100%;margin:0;background:radial-gradient(1200px 600px at 50% -10%, #1f2937, var(--bg));color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Apple Color Emoji,Segoe UI Emoji;}
    .wrap{max-width:920px;margin:0 auto;padding:16px 16px 80px;}
    .card{background:var(--panel);backdrop-filter:blur(8px);border:1px solid #ffffff12;border-radius:24px;box-shadow:0 10px 30px #0006;padding:18px;}
    h1{font-size:28px;margin:6px 0 12px}
    h2{font-size:18px;margin:18px 0 8px;color:var(--muted)}
    .grid{display:grid;gap:12px}
    .g2{grid-template-columns:1fr 1fr}
    @media (max-width:720px){.g2{grid-template-columns:1fr}}
    textarea, input, select{width:100%;background:#0b1220;border:1px solid #ffffff1f;color:var(--ink);padding:12px 14px;border-radius:14px;font-size:16px}
    textarea{min-height:160px;resize:vertical}
    button{appearance:none;border:1px solid #ffffff22;background:#0b1325;color:var(--ink);padding:12px 14px;border-radius:14px;font-size:16px;cursor:pointer}
    button.primary{background:linear-gradient(135deg,var(--accent-2),#22d3ee);border-color:transparent;color:white;font-weight:600}
    button.good{background:linear-gradient(135deg,#16a34a,var(--accent));border-color:transparent;color:white;font-weight:600}
    button.warn{background:linear-gradient(135deg,#f59e0b,#f97316);border-color:transparent;color:#141414;font-weight:700}
    button.ghost{background:#0b1220}
    button:disabled{opacity:.5;cursor:not-allowed}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .pill{padding:8px 12px;border-radius:999px;border:1px solid #ffffff24;background:#0b1220;color:var(--muted);font-size:14px}
    .muted{color:var(--muted)}
    .word{font-size:52px;line-height:1.12;text-align:center;margin:8px 0 12px;font-weight:800;letter-spacing:.3px}
    .score{font-size:18px}
    .hidden{display:none !important}
    .progress{height:10px;border-radius:999px;background:#ffffff1a;overflow:hidden}
    .progress>i{display:block;height:100%;background:linear-gradient(90deg,#22d3ee,var(--accent-2));width:100%}

    /* 3‑column game layout (Left Skip | Middle info + controls | Right Correct) */
    .gameGrid{display:grid;grid-template-columns:1fr minmax(260px,2fr) 1fr;gap:12px;min-height:70vh}
    .touchZone{display:flex;align-items:center;justify-content:center;border:1px dashed #ffffff2a;border-radius:18px;background:#0b1220aa;font-size:28px;font-weight:700;user-select:none;-webkit-user-select:none;touch-action:manipulation}
    .touchZone:active{transform:scale(0.99)}
    .touchZone.skip{border-color:#f59e0b55}
    .touchZone.correct{border-color:#16a34a55}
    .midCol{display:flex;flex-direction:column;gap:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="panel-setup">
      <h1>Heads Up — Custom Deck</h1>
      <div class="muted">Paste your words (one per line), or import JSON. Works offline in your browser.</div>

      <h2>Deck</h2>
      <div class="grid">
        <textarea id="deckText" placeholder="e.g. Einstein
Pani Puri
Blockchain
Sachin Tendulkar
Oscars"></textarea>
        <div class="grid g2">
          <button id="btnSample" class="ghost">Load sample</button>
          <button id="btnShuffle" class="ghost">Shuffle</button>
          <button id="btnImport" class="ghost">Import JSON</button>
          <button id="btnExport" class="ghost">Export JSON</button>
          <button id="btnShare" class="ghost">Share deck link</button>
          <button id="btnSave" class="primary">Save deck</button>
        </div>
      </div>

      <h2>Round Settings</h2>
      <div class="grid g2">
        <label class="row"> <span class="pill">Round length</span>
          <select id="roundLen">
            <option value="45">45 sec</option>
            <option value="60" selected>60 sec</option>
            <option value="90">90 sec</option>
            <option value="120">120 sec</option>
          </select>
        </label>
        <label class="row"> <span class="pill">Skip penalty</span>
          <select id="skipPenalty">
            <option value="0" selected>0 points</option>
            <option value="-1">-1 point</option>
          </select>
        </label>
      </div>

      <h2>Controls</h2>
      <div class="grid">
        <div class="row">
          <button id="btnStart" class="good">Start Round</button>
          <span class="muted">Tap <b>right</b> side = Correct, <b>left</b> side = Skip. No tilt required.</span>
        </div>
      </div>
    </div>

    <div class="card hidden" id="panel-game">
      <div class="gameGrid">
        <div id="zoneLeft" class="touchZone skip">Skip</div>
        <div class="midCol">
          <div class="row" style="justify-content:space-between;align-items:center">
            <div class="row muted"><span class="pill">Time</span> <b id="timeLeft">60</b>s</div>
            <div class="row score">
              <span>✅ <b id="scoreGood">0</b></span>
              <span class="muted">&nbsp;|&nbsp;</span>
              <span>⤼ Skips: <b id="scoreSkip">0</b></span>
            </div>
          </div>

          <div class="word" id="currentWord">—</div>

          <div class="row" style="justify-content:center;gap:10px">
            <button id="btnPause" class="ghost">Pause</button>
            <button id="btnEnd" class="ghost">End</button>
            <button id="btnSetup" class="ghost">Setup</button>
          </div>

          <div class="progress" aria-label="time remaining"><i id="bar"></i></div>
        </div>
        <div id="zoneRight" class="touchZone correct">Right</div>
      </div>
    </div>

    <div class="card hidden" id="panel-summary">
      <h2>Round Summary</h2>
      <div class="row"><span class="pill">Score</span> <b id="sumScore">0</b></div>
      <div class="grid g2" style="margin-top:10px">
        <div>
          <div class="muted">Correct</div>
          <ul id="sumGood"></ul>
        </div>
        <div>
          <div class="muted">Skipped</div>
          <ul id="sumSkip"></ul>
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <button id="btnPlayAgain" class="good">Play Again</button>
        <button id="btnBack" class="ghost">Back to Setup</button>
      </div>
    </div>
  </div>

  <div class="footer muted" style="text-align:center">
    <div>Made for quick custom play. Data stays in your browser.</div>
  </div>

<script>
(function(){
  // ----- State -----
  const els = idMap([
    'panel-setup','panel-game','panel-summary','deckText','btnSample','btnShuffle','btnImport','btnExport','btnShare','btnSave',
    'roundLen','skipPenalty','btnStart','zoneLeft','zoneRight','btnPause','btnEnd','btnSetup','scoreGood','scoreSkip','currentWord','timeLeft','bar','sumScore','sumGood','sumSkip','btnPlayAgain','btnBack'
  ]);

  /** @type {string[]} */
  let deck = [];
  let drawPile = [];
  let roundLength = 60;
  let penalty = 0;
  let timerId = null;
  let deadline = 0;
  let paused = false;
  let cur = '';
  const correct = [];
  const skipped = [];

  // ----- Utilities -----
  function idMap(keys){ const o={}; keys.forEach(k=>o[k]=document.getElementById(k)); return o; }
  const rand = (n)=>Math.floor(Math.random()*n);
  const shuffle = (arr)=>{ for(let i=arr.length-1;i>0;i--){ const j=rand(i+1); [arr[i],arr[j]]=[arr[j],arr[i]] } return arr };
  const b64 = {
    enc: (obj)=> btoa(unescape(encodeURIComponent(JSON.stringify(obj)))).replace(/=+$/,'') ,
    dec: (s)=> JSON.parse(decodeURIComponent(escape(atob(s))))
  };
  function toast(msg){
    const t = document.createElement('div');
    t.textContent = msg; t.style.cssText = 'position:fixed;left:50%;bottom:64px;transform:translateX(-50%);background:#111827;border:1px solid #ffffff33;padding:10px 14px;border-radius:12px;color:#e5e7eb;box-shadow:0 10px 30px #0009;z-index:1000';
    document.body.appendChild(t); setTimeout(()=>t.remove(),2200);
  }

  // ----- Text utilities (fix for invalid RegExp) -----
  function splitLines(text){
    // Correct cross-platform newline handling: LF or CRLF
    return text.split(/\r?\n/);
  }
  function normalizeWords(text){
    return Array.from(new Set(splitLines(text).map(s=>s.trim()).filter(Boolean)));
  }

  // ----- Persistence -----
  const STORAGE_KEY = 'headsup.customDeck.v1';
  function saveDeck(words){ localStorage.setItem(STORAGE_KEY, JSON.stringify(words)); }
  function loadDeck(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]') } catch{ return [] } }

  // ----- Deck helpers -----
  function parseTextarea(){ return normalizeWords(els.deckText.value); }
  function setTextareaFromDeck(arr){ els.deckText.value = arr.join('\n'); }

  // ----- URL import -----
  (function importFromURL(){
    const u = new URL(location.href);
    const q = u.searchParams.get('deck');
    if(q){
      try{ deck = b64.dec(q); setTextareaFromDeck(deck); toast('Loaded deck from link'); }
      catch{ /* ignore */ }
    } else {
      const saved = loadDeck(); if(saved.length){ deck = saved; setTextareaFromDeck(deck); }
    }
  })();

  // ----- Sample deck -----
  const SAMPLE = [
    'Albert Einstein','Pani Puri','Sachin Tendulkar','Blockchain','Photosynthesis','The Oscars','The Godfather','Mount Everest','Mona Lisa','Harry Potter',
    'Diwali','Virat Kohli','Machine Learning','Shah Rukh Khan','Bangalore Traffic','Coconut Water','Dosa','Cricket World Cup','Meditation','Yoga'
  ];

  // ----- Setup actions -----
  els.btnSample.onclick = ()=>{ setTextareaFromDeck(SAMPLE); toast('Sample deck loaded'); };
  els.btnShuffle.onclick = ()=>{ const arr=parseTextarea(); shuffle(arr); setTextareaFromDeck(arr); };
  els.btnImport.onclick = ()=>{
    const s = prompt('Paste deck JSON (e.g. ["Word1","Word2"])');
    if(!s) return; try{ const arr = JSON.parse(s); if(Array.isArray(arr)){ setTextareaFromDeck(arr); toast('Imported JSON'); } }
    catch{ alert('Invalid JSON'); }
  };
  els.btnExport.onclick = ()=>{ const arr=parseTextarea(); navigator.clipboard.writeText(JSON.stringify(arr,null,0)); toast('Copied JSON to clipboard'); };
  els.btnShare.onclick = ()=>{
    const arr=parseTextarea(); const url = new URL(location.href); url.searchParams.set('deck', b64.enc(arr));
    const link = url.toString();
    if(navigator.share){ navigator.share({title:'Heads Up Deck',url:link}).catch(()=>navigator.clipboard.writeText(link).then(()=>toast('Link copied'))); }
    else { navigator.clipboard.writeText(link).then(()=>toast('Link copied to clipboard')); }
  };
  els.btnSave.onclick = ()=>{ deck=parseTextarea(); saveDeck(deck); toast('Deck saved to this device'); };

  // ----- Start Round -----
  els.btnStart.onclick = startRound;
  function startRound(){
    deck = parseTextarea();
    if(deck.length < 2){ alert('Please add at least 2 words.'); return }
    roundLength = parseInt(els.roundLen.value,10)||60;
    penalty = parseInt(els.skipPenalty.value,10)||0;
    drawPile = shuffle(deck.slice());
    correct.length = 0; skipped.length = 0; updateScore();
    els.timeLeft.textContent = String(roundLength);
    show('panel-game');
    paused = false; cur = '';
    nextWord();
    deadline = Date.now() + roundLength*1000;
    tick();
    if (document.documentElement.requestFullscreen) { document.documentElement.requestFullscreen().catch(()=>{}); }
  }

  function updateScore(){ els.scoreGood.textContent = String(correct.length); els.scoreSkip.textContent = String(skipped.length); }
  function nextWord(){ if(drawPile.length===0){ drawPile = shuffle(deck.slice()); } cur = drawPile.pop(); els.currentWord.textContent = cur; }

  function endRound(){
    clearTimeout(timerId); timerId=null;
    const total = correct.length + penalty*skipped.length;
    els.sumScore.textContent = String(total);
    listInto('sumGood', correct);
    listInto('sumSkip', skipped);
    show('panel-summary');
    if (document.fullscreenElement && document.exitFullscreen) { document.exitFullscreen().catch(()=>{}); }
  }

  function listInto(id, arr){ const ul = els[id]; ul.innerHTML=''; arr.forEach(w=>{ const li=document.createElement('li'); li.textContent=w; ul.appendChild(li); }); }

  function tick(){
    if(paused){ timerId = setTimeout(tick, 200); return }
    const remain = Math.max(0, deadline - Date.now());
    const secs = Math.ceil(remain/1000);
    els.timeLeft.textContent = String(secs);
    const pct = Math.max(0, Math.min(1, remain/(roundLength*1000)));
    els.bar.style.width = (pct*100).toFixed(1)+'%';
    if(remain<=0){ endRound(); return }
    timerId = setTimeout(tick, 100);
  }

  // ----- Tap Zones -----
  function vibrate(ms){ if(navigator.vibrate) try{ navigator.vibrate(ms); }catch{} }
  els.zoneRight.addEventListener('click', ()=>{ if(!paused){ correct.push(cur); updateScore(); nextWord(); vibrate(30); } });
  els.zoneLeft.addEventListener('click',  ()=>{ if(!paused){ skipped.push(cur); updateScore(); nextWord(); vibrate(15); } });
  // Low-latency touchstart
  els.zoneRight.addEventListener('touchstart', (e)=>{ e.preventDefault(); if(!paused){ correct.push(cur); updateScore(); nextWord(); vibrate(30); } }, {passive:false});
  els.zoneLeft.addEventListener('touchstart',  (e)=>{ e.preventDefault(); if(!paused){ skipped.push(cur); updateScore(); nextWord(); vibrate(15); } }, {passive:false});

  // ----- In-game buttons -----
  els.btnEnd.onclick = endRound;
  els.btnPause.onclick = ()=>{ paused = !paused; els.btnPause.textContent = paused? 'Resume' : 'Pause'; if(!paused) tick(); };
  els.btnSetup.onclick = ()=>{ paused=true; show('panel-setup'); if (document.fullscreenElement && document.exitFullscreen) { document.exitFullscreen().catch(()=>{}); } };

  // ----- Summary actions -----
  els.btnPlayAgain.onclick = ()=>{ show('panel-game'); roundLength = parseInt(els.roundLen.value,10)||60; deadline = Date.now()+roundLength*1000; correct.length=0; skipped.length=0; updateScore(); drawPile=shuffle(deck.slice()); nextWord(); tick(); };
  els.btnBack.onclick = ()=>{ show('panel-setup'); };

  // ----- View switcher -----
  function show(id){ ['panel-setup','panel-game','panel-summary'].forEach(k=>{ document.getElementById(k).classList.toggle('hidden', k!==id); }); }

  // ----- Keyboard shortcuts (desktop testing) -----
  window.addEventListener('keydown', (e)=>{
    if(els['panel-game'].classList.contains('hidden')) return;
    if(e.key==='ArrowRight' || e.key===' '){ correct.push(cur); updateScore(); nextWord(); }
    if(e.key==='ArrowLeft'){ skipped.push(cur); updateScore(); nextWord(); }
    if(e.key==='Escape'){ endRound(); }
  });

  // ----- Self-tests (run once; results in console) -----
  (function selfTests(){
    const cases = [
      {name:'LF split',       input:'a\nb\nc',         want:['a','b','c']},
      {name:'CRLF split',     input:'a\r\nb\r\nc',     want:['a','b','c']},
      {name:'Keeps empties',  input:'a\n\n b ',       want:['a','',' b ']},
      {name:'Normalize',      input:'  A\nA\nB\n\n', wantNorm:['A','B']},
    ];
    let ok = true;
    for(const t of cases){
      const got = splitLines(t.input);
      if(t.want && (got.length!==t.want.length || got.some((v,i)=>v!==t.want[i]))){
        ok=false; console.error('❌ splitLines failed:', t.name, {got, want:t.want}); break;
      }
      if(t.wantNorm){
        const gn = normalizeWords(t.input);
        if(gn.length!==t.wantNorm.length || gn.some((v,i)=>v!==t.wantNorm[i])){
          ok=false; console.error('❌ normalizeWords failed:', t.name, {got:gn, want:t.wantNorm}); break;
        }
      }
    }
    console[ok?'log':'error']('Self-tests ' + (ok?'passed ✅':'failed ❌'));
  })();
})();
</script>
</body>
</html>
